```{r}
library(tidyverse)
library(haven)
```


```{r}
# Read in the cumulative CCES data
cc <- read_dta("cumulative_2006-2023.dta")
# Read 2022 CCES data
cc22 <- read_dta("CCES22_Common_OUTPUT_vv_topost.dta")
# Read 2020 CCES data
cc20 <- read_dta("CCES20.dta")
```

```{r}
# Subset media variables
# NOTE: caseid is the ID variable in the 2022 CCES data
cc22_media <- cc22 |>
  select(caseid, matches("CC22_300"))

# Subset media variables for 2020 data
# NOTE: caseid is the ID variable in the 2020 CCES data
cc20_media <- cc20 |>
  select(caseid, matches("CC20_300"))
```

```{r}
# Helper function to standardize media variables across years
standardize_media_vars <- function(data, year) {
  # Select relevant columns and rename them
  prefix <- paste0("CC", year, "_300")
 
  data |>
    select(caseid, matches(prefix)) |>
    # Rename columns to remove year prefix
    rename_with(~str_replace(., prefix, "300"), matches(prefix))
}

# Process each year's data
cc22_media <- standardize_media_vars(cc22, "22")
cc20_media <- standardize_media_vars(cc20, "20")
```


```{r}
# Function to merge media data with cumulative data for a specific year
merge_media_data <- function(media_data, year) {
  cc |>
    filter(year == year) |>
    mutate(case_id = as.numeric(case_id)) |>
    left_join(media_data, by = c("case_id" = "caseid"))
}

# Merge data for each year
cc22_merged <- merge_media_data(cc22_media, 2022)
cc20_merged <- merge_media_data(cc20_media, 2020)
```

```{r}
# Combine 2020 and 2022 data with only necessary variables
cc_media <- bind_rows(
  # 2020 data
  cc20_merged |>
    filter(year == 2020) |>
    select(year, case_id, ideo5, age, matches("300b_[1-8]")),
  
  # 2022 data
  cc22_merged |>
    filter(year == 2022) |>
    select(year, case_id, ideo5, age, matches("300b_[1-8]"))
)

```

```{r}
clean_network_names <- function(network_col) {
  case_when(
    network_col == "300b_1" ~ "ABC",
    network_col == "300b_2" ~ "CBS",
    network_col == "300b_3" ~ "NBC",
    network_col == "300b_4" ~ "CNN",
    network_col == "300b_5" ~ "Fox News",
    network_col == "300b_6" ~ "MSNBC",
    network_col == "300b_7" ~ "PBS",
    network_col == "300b_8" ~ "Other",
  )
}
```

```{r}
# Create summary of network preferences in 2022
cc_media |>
  filter(year == 2020) |>
  select(matches("300b_[1-8]")) |>
  summarise(across(everything(), 
                  ~sum(.x == 1, na.rm = TRUE))) |>
  pivot_longer(everything(), 
              names_to = "network",
              values_to = "viewers")
```

```{r}
# Create network viewership plot for 2020
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]")) |>
  summarise(across(everything(), 
                  ~sum(.x == 1, na.rm = TRUE))) |>
  pivot_longer(everything(), 
              names_to = "network",
              values_to = "viewers") |>
  # Clean up network names
  mutate(
    network = clean_network_names(network),
    # Convert to factor and order by viewership
    network = fct_reorder(network, viewers)
  ) |>
  # Create the plot
  ggplot(aes(x = network, y = viewers)) +
  geom_col(fill = "#b45346") +
  coord_flip() + # Horizontal bars
  labs(
    title = "Network News Viewership in 2020 (Unweighted)",
    x = "Network",
    y = "Number of Viewers",
    caption = "Source: CCES 2020"
  ) +
  theme_minimal()
```


Crosstabs ideology and media consumption 2020
```{r}
# Create ideology and media consumption analysis
cc_media_ideo <- cc_media |>
  filter(year == 2020) |>
  # Select network preferences and ideology
  select(matches("300b_[1-8]"), ideo5) |>
  # Reshape network data to long format
  pivot_longer(
    cols = matches("300b_"),
    names_to = "network",
    values_to = "watches"
  ) |>
  # Clean up network names
  mutate(
    network = clean_network_names(network),
    # Convert ideo5 to factor
    ideo5 = haven::as_factor(ideo5)
  ) |>
  # Filter for those who watch (watches == 1)
  filter(watches == 1) |>
  # Create cross-tabulation
  count(network, ideo5) |>
  # Convert to percentages within each network
  group_by(network) |>
  mutate(pct = n / sum(n) * 100) |>
  ungroup()

cc_media_ideo
```

Formatted Crosstabs
```{r}
# Create formatted table
cc_media_ideo |>
  # Round percentages
  mutate(pct = round(pct, 1)) |>
  # Pivot wider for easier reading
  pivot_wider(
    names_from = ideo5,
    values_from = c(n, pct)
  ) |>
  # Arrange by total viewership
  arrange(desc(rowSums(across(starts_with("n_")), na.rm = TRUE)))
```


Ideological composition of network news viewers bar chart 2020
```{r}
# Create stacked bar chart
ggplot(cc_media_ideo, aes(x = network, y = pct, fill = fct_rev(ideo5))) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values = c(
    "Not Sure" = "grey70",
    "NA" = "grey90",
    "Very Liberal" = "#2166ac",      # Dark blue
    "Liberal" = "#67a9cf",           # Light blue
    "Moderate" = "#8f34b6",          # Purple
    "Conservative" = "#ef8a62",      # Light red
    "Very Conservative" = "#b2182b"  # Dark red
  )) +
  labs(
    title = "Ideological Composition of Network News Viewers 2020",
    x = "Network",
    y = "Percentage of Viewers",
    fill = "Ideology",
    caption = "Source: CCES 2020"
  ) +
  theme_minimal()
```


1. **Strong ideologues show different viewing patterns**
   - Very Conservatives heavily favor Fox News (23.1% of Fox viewers)
   - Very Liberals favor MSNBC and CNN (20.7% and 17.8% of their viewers)
   - Both groups have lower viewership of centrist networks

2. **Moderates dominate broadcast network viewership**
   - Moderates make up ~38% of ABC, CBS, and NBC viewers
   - Moderates also represent significant portions of CNN (37.6%) and PBS (35.9%)
   - Even Fox News has substantial moderate viewership (28.2%)

3. **Clear ideological network preferences**
   - Fox News viewers skew conservative (57.2% Conservative/Very Conservative)
   - MSNBC viewers skew liberal (56.4% Liberal/Very Liberal)
   - Broadcast networks (ABC, CBS, NBC) maintain more balanced viewership

This suggests network preferences align with ideological leanings, though most networks maintain a significant moderate audience base. Broadcast networks appear most successful at reaching across ideological lines.




How many people watch multiple networks in 2020?
```{r}
# Check multiple network viewing
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]")) |>
  # Count how many networks each person watches (where value == 1)
  mutate(
    networks_watched = rowSums(across(everything(), ~.x == 1), na.rm = TRUE)
  ) |>
  # Summarize the distribution
  count(networks_watched) |>
  # Calculate percentages
  mutate(pct = n/sum(n) * 100)
```



Cross tab of relationship between ideology and number of networks watched in 2020
```{r}
# Analyze ideology vs number of networks watched
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]"), ideo5) |>
  # Count networks watched and convert ideology to factor
  mutate(
    networks_watched = rowSums(across(matches("300b_"), ~.x == 1), na.rm = TRUE),
    ideo5 = haven::as_factor(ideo5)
  ) |>
  # Group by ideology and calculate mean networks watched
  group_by(ideo5) |>
  summarise(
    n = n(),  # number of respondents
    mean_networks = mean(networks_watched, na.rm = TRUE),
    median_networks = median(networks_watched, na.rm = TRUE),
    zero_networks = mean(networks_watched == 0, na.rm = TRUE) * 100,  # % watching zero
    multiple_networks = mean(networks_watched > 1, na.rm = TRUE) * 100  # % watching multiple
  ) |>
  # Remove NA ideology if present
  filter(!is.na(ideo5))
```

bar chart of above FOR 2020
```{r}
# Create bar chart of average networks watched by ideology
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]"), ideo5) |>
  mutate(
    networks_watched = rowSums(across(matches("300b_"), ~.x == 1), na.rm = TRUE),
    ideo5 = haven::as_factor(ideo5)
  ) |>
  # Calculate mean networks watched per ideology
  group_by(ideo5) |>
  summarise(
    avg_networks = mean(networks_watched, na.rm = TRUE),
    se = sd(networks_watched, na.rm = TRUE) / sqrt(n())  # standard error for error bars
  ) |>
  # Create the plot
  ggplot(aes(x = ideo5, y = avg_networks)) +
  geom_col(fill = "#b45346") +
  geom_errorbar(aes(ymin = avg_networks - se, ymax = avg_networks + se),
                width = 0.2) +
  labs(
    title = "Average Number of Networks Watched by Ideological Group (2020)",
    x = "Ideology",
    y = "Average Number of Networks Watched",
    caption = "Source: CCES 2020"
  ) +
  theme_minimal() +
  coord_flip()
```





1. **Strong ideologues show different viewing patterns**
   - Very Conservatives average 0.76 networks
   - Very Liberals average 1.03 networks
   - Both groups have lower multiple-network viewing rates (19.2% and 28.1% respectively)

2. **Liberals and moderates consume more diverse sources**
   - Liberals watch most networks (mean = 1.28)
   - Moderates follow closely (mean = 1.14)
   - Liberals most likely to watch multiple networks (36.2%)

3. **Overall low TV news consumption**
   - ~51-59% watch zero networks across most ideological groups
   - Exception: "Not Sure" group shows even lower engagement (81.0% watch none)

This suggests ideological polarization may relate to more limited news source selection, with liberals showing the highest engagement with multiple sources. Traditional TV news networks have low viewership across all groups.



## Q1: Age

average age by network in 2020

```{r}
# Analyze age by network viewership
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]"), age) |>
  # Reshape to long format
  pivot_longer(
    cols = matches("300b_"),
    names_to = "network",
    values_to = "watches"
  ) |>
  # Clean network names and group broadcast networks
  mutate(
    network = clean_network_names(network),
  ) |>
  # Filter for viewers
  filter(watches == 1) |>
  # Calculate age statistics by network
  group_by(network) |>
  summarise(
    mean_age = mean(age, na.rm = TRUE),
    median_age = median(age, na.rm = TRUE),
    n = n()
  ) |>
  arrange(desc(mean_age))
```


age groups and visualize the distribution
```{r}
# Create age distribution plot
cc_media |> 
  filter(year == 2020) |>
  select(matches("300b_[1-8]"), age) |>
  pivot_longer(
    cols = matches("300b_"),
    names_to = "network",
    values_to = "watches"
  ) |>
  mutate(
    network = clean_network_names(network),
  ) |>
  filter(watches == 1) |>
  ggplot(aes(x = age, fill = network)) +
  geom_density(alpha = 0.5) +
  labs(
    title = "Age Distribution of Network News Viewers",
    x = "Age",
    y = "Density",
    fill = "Network",
    caption = "Source: CCES 2022"
  ) +
  theme_minimal()
```



Analysis of Age and Network News Viewership:

1. CNN has notably younger audience (mean age 50, median 52)
2. PBS and MSNBC have oldest viewers (mean age 56)
3. Broadcast Networks (NBC, CBS, ABC) range from 52-54 mean age
4. Fox News viewers align with overall trend (mean 54, median 57)
5. All networks skew older, with median ages ranging from 52-59

This suggests traditional TV news, regardless of network, primarily reaches older Americans, with CNN being somewhat more successful at attracting younger viewers.



# TODO
 - X Import 2020 CCES data
 - Use `cumulative_ces_policy_preferences.dta` which ends in 2021